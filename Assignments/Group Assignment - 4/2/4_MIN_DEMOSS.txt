SELECT WORD, SUM/CNT AS AVG_SCORE FROM
  (SELECT WORD, SUM(SCORE) AS SUM, COUNT(SCORE) AS CNT FROM
      (
        SELECT WORD, TDOC_ID AS DOC_ID, FREQ/DocSize AS SCORE FROM(
            (SELECT DOC_ID AS TDOC_ID, sum(FREQ) AS DocSize FROM INVINDEX GROUP BY TDOC_ID) 
                INNER JOIN
            (SELECT DOC_ID AS SDOC_ID, WORD, FREQ FROM INVINDEX)
                ON TDOC_ID=SDOC_ID
            )
    ) AS TEMP
  GROUP BY WORD) AS RESULT_TABLE ORDER BY AVGSCORE DESC;
